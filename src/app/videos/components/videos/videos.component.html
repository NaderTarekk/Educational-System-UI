<!-- src/app/pages/videos/videos.component.html -->
<div class="min-h-screen bg-gray-50 p-4 md:p-6" dir="rtl">

    <!-- Page Title -->
    <div class="flex justify-between items-center mb-6">
        <div>
            <h1 class="text-2xl md:text-3xl font-bold text-gray-800">إدارة الفيديوهات التعليمية</h1>
            <p class="text-gray-600 mt-1 text-sm md:text-base">رفع وإدارة المحتوى التعليمي للطلاب</p>
        </div>

        <button *ngIf="canEdit()" (click)="openUploadModal()"
            class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-4 md:px-6 py-2 md:py-3 rounded-xl hover:shadow-xl hover:scale-105 transition-all flex items-center gap-2 font-bold">
            <i class="fas fa-cloud-upload-alt"></i>
            <span class="hidden md:inline">رفع فيديو جديد</span>
            <span class="md:hidden">رفع</span>
        </button>
    </div>

    <!-- Stats Cards -->
    <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6" *ngIf="userRole === 'Admin' || userRole === 'Assistant' ">
        <!-- Total Videos -->
        <div class="bg-gradient-to-br from-indigo-500 to-indigo-600 rounded-xl p-4 md:p-6 shadow-lg text-white">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-indigo-100 text-xs md:text-sm mb-1">إجمالي الفيديوهات </p>
                    <p class="text-2xl md:text-3xl font-bold">{{stats.totalVideos}}</p>
                </div>
                <div class="w-12 h-12 md:w-14 md:h-14  bg-opacity-20 rounded-full flex items-center justify-center">
                    <i class="fas fa-video text-2xl md:text-3xl"></i>
                </div>
            </div>
        </div>

        <!-- Published -->
        <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-xl p-4 md:p-6 shadow-lg text-white">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-green-100 text-xs md:text-sm mb-1">منشورة</p>
                    <p class="text-2xl md:text-3xl font-bold">{{stats.published}}</p>
                </div>
                <div class="w-12 h-12 md:w-14 md:h-14  bg-opacity-20 rounded-full flex items-center justify-center">
                    <i class="fas fa-check-circle text-2xl md:text-3xl"></i>
                </div>
            </div>
        </div>

        <!-- Draft -->
        <div class="bg-gradient-to-br from-orange-500 to-orange-600 rounded-xl p-4 md:p-6 shadow-lg text-white">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-orange-100 text-xs md:text-sm mb-1">مسودة</p>
                    <p class="text-2xl md:text-3xl font-bold">{{stats.draft}}</p>
                </div>
                <div class="w-12 h-12 md:w-14 md:h-14  bg-opacity-20 rounded-full flex items-center justify-center">
                    <i class="fas fa-edit text-2xl md:text-3xl"></i>
                </div>
            </div>
        </div>

        <!-- Total Views -->
        <div class="bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl p-4 md:p-6 shadow-lg text-white">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-purple-100 text-xs md:text-sm mb-1">إجمالي المشاهدات</p>
                    <p class="text-2xl md:text-3xl font-bold">{{stats.totalViews | number}}</p>
                </div>
                <div class="w-12 h-12 md:w-14 md:h-14  bg-opacity-20 rounded-full flex items-center justify-center">
                    <i class="fas fa-eye text-2xl md:text-3xl"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- Filters -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-4 md:p-6 mb-6">
        <div class="flex flex-col md:flex-row md:flex-wrap items-start md:items-center gap-4">
            <!-- Status Filter -->
            <div class="flex flex-wrap items-center gap-2 w-full md:w-auto">
                <label class="text-sm font-medium text-gray-700">الحالة:</label>
                <button (click)="filterVideos('all')" [class.bg-indigo-600]="selectedFilter === 'all'"
                    [class.text-white]="selectedFilter === 'all'" [class.bg-gray-100]="selectedFilter !== 'all'"
                    [class.text-gray-700]="selectedFilter !== 'all'"
                    class="px-3 md:px-4 py-2 rounded-lg font-medium transition-all hover:scale-105 text-sm">
                    الكل
                </button>
                <button (click)="filterVideos('published')" [class.bg-indigo-600]="selectedFilter === 'published'"
                    *ngIf="userRole == 'Admin' || userRole == 'Assistant'"
                    [class.text-white]="selectedFilter === 'published'"
                    [class.bg-gray-100]="selectedFilter !== 'published'"
                    [class.text-gray-700]="selectedFilter !== 'published'"
                    class="px-3 md:px-4 py-2 rounded-lg font-medium transition-all hover:scale-105 text-sm">
                    منشورة
                </button>
                <button *ngIf="canEdit()" (click)="filterVideos('draft')"
                    [class.bg-indigo-600]="selectedFilter === 'draft'" [class.text-white]="selectedFilter === 'draft'"
                    [class.bg-gray-100]="selectedFilter !== 'draft'" [class.text-gray-700]="selectedFilter !== 'draft'"
                    class="px-3 md:px-4 py-2 rounded-lg font-medium transition-all hover:scale-105 text-sm">
                    مسودة
                </button>
            </div>

            <!-- Subject Filter -->
            <div class="flex items-center gap-2 w-full md:w-auto">
                <label class="text-sm font-medium text-gray-700">المادة:</label>
                <select [(ngModel)]="selectedSubject" (ngModelChange)="onSubjectChange()"
                    class="px-3 md:px-4 py-2 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-indigo-500 transition-all text-sm">
                    <option value="all">جميع المواد</option>
                    <!-- ⬅️ غيرها من subject لـ subject.name -->
                    <option *ngFor="let subject of subjects" [value]="subject.name">{{subject.name}}</option>
                </select>
            </div>

            <!-- Grade Filter -->
            <div class="flex items-center gap-2 w-full md:w-auto">
                <label class="text-sm font-medium text-gray-700">المجموعة:</label>
                <select [(ngModel)]="selectedGroup" (ngModelChange)="onGroupChange()"
                    class="px-3 md:px-4 py-2 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-indigo-500 transition-all text-sm">
                    <option value="all">جميع المجموعات</option>
                    <option *ngFor="let group of groups" [value]="group.id">{{group.name}}</option>
                </select>
            </div>

            <div class="flex-1"></div>

            <!-- Search -->
            <div class="relative w-full md:w-64">
                <input type="text" [(ngModel)]="searchText" (ngModelChange)="onSearchChange()"
                    placeholder="ابحث عن فيديو..."
                    class="w-full px-4 py-2 pr-10 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-indigo-500 transition-all text-sm">
                <i class="fas fa-search absolute right-3 top-3 text-gray-400"></i>
            </div>
        </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="text-center py-16">
        <div class="inline-block w-16 h-16 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin">
        </div>
        <p class="mt-4 text-gray-600 font-semibold">جاري تحميل الفيديوهات...</p>
    </div>

    <!-- Videos Grid -->
    <div *ngIf="!isLoading" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6">
        <div *ngFor="let video of getFilteredVideos()"
            class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden hover:shadow-xl transition-all group">

            <!-- Thumbnail -->
            <div class="relative overflow-hidden bg-gray-200 aspect-video">
                <!-- ✅ PDF Icon -->
                <div *ngIf="isPdf(video)" class="w-full h-full flex items-center justify-center bg-orange-50">
                    <i class="fas fa-file-pdf text-orange-500 text-6xl"></i>
                </div>

                <!-- ✅ Video Thumbnail -->
                <img *ngIf="!isPdf(video)"
                    [src]="video.thumbnailUrl || 'https://play.google.com/store/apps/details?id=com.vidmar.pti'"
                    [alt]="video.title"
                    class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500">

                <div
                    class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-40 transition-all flex items-center justify-center">
                    <button (click)="viewVideo(video)"
                        class="opacity-0 group-hover:opacity-100 transition-all bg-white rounded-full p-3 md:p-4 shadow-2xl hover:scale-110 transform">
                        <!-- ✅ أيقونة مختلفة للـ PDF -->
                        <i class="fas text-2xl md:text-3xl" [class.fa-play]="!isPdf(video)"
                            [class.fa-eye]="isPdf(video)" [class.text-indigo-600]="!isPdf(video)"
                            [class.text-orange-600]="isPdf(video)">
                        </i>
                    </button>
                </div>

                <span
                    class="absolute bottom-2 right-2 bg-black bg-opacity-70 text-white px-2 py-1 rounded text-xs font-medium">
                    {{video.duration || '00:00'}}
                </span>

                <!-- Free Badge -->
                <span *ngIf="video.isFree"
                    class="absolute top-2 left-2 bg-green-500 text-white px-2 py-1 rounded text-xs font-bold flex items-center gap-1">
                    <i class="fas fa-gift"></i>
                    مجاني
                </span>

                <!-- Draft Badge - عدّل الموقع -->
                <span *ngIf="!video.isPublished && !video.isFree"
                    class="absolute top-2 left-2 bg-orange-500 text-white px-2 py-1 rounded text-xs font-bold">
                    مسودة
                </span>

                <!-- ✅ PDF Badge -->
                <span *ngIf="isPdf(video)"
                    class="absolute top-2 right-2 bg-orange-600 text-white px-2 py-1 rounded text-xs font-bold">
                    <i class="fas fa-file-pdf ml-1"></i>
                    PDF
                </span>
            </div>

            <!-- Content -->
            <div class="p-4">
                <div class="flex items-start justify-between mb-2">
                    <h3 class="text-base md:text-lg font-bold text-gray-800 line-clamp-2 flex-1">{{video.title}}</h3>
                    <div *ngIf="canEdit()" class="flex gap-1 mr-2">
                        <button (click)="editVideo(video)" class="p-1.5 hover:bg-gray-100 rounded-lg transition-all"
                            title="تعديل">
                            <i class="fas fa-edit text-gray-600"></i>
                        </button>
                        <button (click)="openDeleteDialog(video)"
                            class="p-1.5 hover:bg-red-50 rounded-lg transition-all" title="حذف">
                            <i class="fas fa-trash text-red-600"></i>
                        </button>
                    </div>
                </div>

                <p class="text-sm text-gray-600 line-clamp-2 mb-3">{{video.description || 'لا يوجد وصف'}}</p>

                <div class="flex flex-wrap gap-2 mb-3">
                    <span [ngClass]="getCategoryColor(video.category)"
                        class="px-2 py-1 rounded-full text-xs font-medium">
                        {{video.category}}
                    </span>
                    <span class="bg-blue-100 text-blue-700 px-2 py-1 rounded-full text-xs font-medium">
                        {{video.subject}}
                    </span>
                    <span class="bg-purple-100 text-purple-700 px-2 py-1 rounded-full text-xs font-medium"
                        *ngIf="userRole == 'Admin' || userRole == 'Assistant'">
                        {{getGroupName(video.grade)}}
                    </span>
                </div>

                <div class="flex items-center justify-between text-sm text-gray-500 mb-3">
                    <div class="flex items-center gap-3">
                        <button (click)="toggleLike(video)"
                            class="flex items-center gap-1 hover:text-red-500 transition-colors">
                            <i class="fas fa-heart" [class.text-red-500]="video.isLikedByCurrentUser"
                                [class.text-gray-400]="!video.isLikedByCurrentUser"></i>
                            <span>{{video.likes | number}}</span>
                        </button>
                        <span class="flex items-center gap-1">
                            <i class="fas fa-eye"></i>
                            {{video.views | number}}
                        </span>
                    </div>
                    <span class="text-xs">{{video.fileSize || 'N/A'}}</span>
                </div>

                <div class="flex items-center justify-between pt-3 border-t border-gray-100">
                    <div class="flex items-center gap-2">
                        <div
                            class="w-8 h-8 bg-indigo-600 rounded-full flex items-center justify-center text-white text-xs font-bold">
                            {{getInitials(video.uploadedByUser.fullName)}}
                        </div>
                        <div>
                            <p class="text-xs font-medium text-gray-700">{{video.uploadedByUser.fullName}}</p>
                            <p class="text-xs text-gray-500">{{video.uploadDate | date:'shortDate'}}</p>
                        </div>
                    </div>

                    <button *ngIf="canEdit()" (click)="togglePublish(video)" [class.bg-green-100]="video.isPublished"
                        [class.text-green-700]="video.isPublished" [class.bg-gray-100]="!video.isPublished"
                        [class.text-gray-700]="!video.isPublished"
                        class="px-3 py-1.5 rounded-lg text-xs font-bold transition-all hover:scale-105 flex items-center gap-1">
                        <i class="fas" [class.fa-check-circle]="video.isPublished"
                            [class.fa-times-circle]="!video.isPublished"></i>
                        {{video.isPublished ? 'منشور' : 'غير منشور'}}
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="!isLoading && getFilteredVideos().length === 0" class="text-center py-16">
        <div class="w-24 h-24 mx-auto mb-6 bg-gray-100 rounded-full flex items-center justify-center">
            <i class="fas fa-video text-5xl text-gray-400"></i>
        </div>
        <h3 class="text-xl font-bold text-gray-700 mb-2">لا توجد فيديوهات</h3>
        <p class="text-gray-500">لم يتم العثور على أي فيديوهات تطابق البحث</p>
    </div>

    <!-- Pagination -->
    <div *ngIf="!isLoading && totalPages > 1" class="flex items-center justify-center gap-2 mt-8">
        <button (click)="previousPage()" [disabled]="currentPage === 1"
            class="px-4 py-2 bg-white border-2 border-gray-200 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-all">
            <i class="fas fa-chevron-right"></i>
        </button>

        <button *ngFor="let page of [].constructor(totalPages); let i = index" (click)="goToPage(i + 1)"
            [class.bg-indigo-600]="currentPage === i + 1" [class.text-white]="currentPage === i + 1"
            [class.bg-white]="currentPage !== i + 1" [class.text-gray-700]="currentPage !== i + 1"
            class="px-4 py-2 border-2 border-gray-200 rounded-lg hover:bg-gray-50 transition-all font-bold">
            {{i + 1}}
        </button>

        <button (click)="nextPage()" [disabled]="currentPage === totalPages"
            class="px-4 py-2 bg-white border-2 border-gray-200 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-all">
            <i class="fas fa-chevron-left"></i>
        </button>
    </div>

</div>

<!-- Upload Modal -->
<div *ngIf="showUploadModal"
    class="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-fadeIn"
    (click)="closeUploadModal()">

    <div (click)="$event.stopPropagation()"
        class="bg-white rounded-3xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden animate-slideUp">

        <!-- Header -->
        <div class="bg-gradient-to-r from-indigo-600 to-purple-600 p-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <div class="w-14 h-14 bg-white/20 backdrop-blur-xl rounded-2xl flex items-center justify-center">
                        <i class="fas fa-cloud-upload-alt text-white text-2xl"></i>
                    </div>
                    <div>
                        <h2 class="text-2xl font-bold text-white">رفع فيديو جديد</h2>
                        <p class="text-white/80 text-sm mt-1">أضف محتوى تعليمي للطلاب</p>
                    </div>
                </div>
                <button (click)="closeUploadModal()"
                    class="w-10 h-10 bg-white/20 hover:bg-white/30 rounded-xl transition-all flex items-center justify-center">
                    <i class="fas fa-times text-white text-xl"></i>
                </button>
            </div>
        </div>

        <!-- Form -->
        <div class="p-6 overflow-y-auto max-h-[calc(90vh-200px)]">
            <div class="space-y-4">
                <!-- File Upload -->
                <!-- Video Source Selection -->
                <!-- Content Type Selection -->
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-3">
                        <i class="fas fa-file text-indigo-600 ml-2"></i>
                        نوع المحتوى
                    </label>
                    <div class="flex gap-3">
                        <!-- YouTube -->
                        <button type="button" (click)="contentType = 'youtube'"
                            [class.bg-red-600]="contentType === 'youtube'"
                            [class.text-white]="contentType === 'youtube'"
                            [class.bg-gray-100]="contentType !== 'youtube'"
                            [class.text-gray-700]="contentType !== 'youtube'"
                            class="flex-1 px-4 py-3 rounded-xl font-bold transition-all border-2 hover:scale-105"
                            [class.border-red-600]="contentType === 'youtube'"
                            [class.border-gray-200]="contentType !== 'youtube'">
                            <i class="fab fa-youtube ml-2"></i>
                            YouTube
                        </button>

                        <!-- PDF -->
                        <button type="button" (click)="contentType = 'pdf'"
                            [class.bg-orange-600]="contentType === 'pdf'" [class.text-white]="contentType === 'pdf'"
                            [class.bg-gray-100]="contentType !== 'pdf'" [class.text-gray-700]="contentType !== 'pdf'"
                            class="flex-1 px-4 py-3 rounded-xl font-bold transition-all border-2 hover:scale-105"
                            [class.border-orange-600]="contentType === 'pdf'"
                            [class.border-gray-200]="contentType !== 'pdf'">
                            <i class="fas fa-file-pdf ml-2"></i>
                            PDF
                        </button>
                    </div>
                </div>

                <!-- YouTube URL Input -->
                <div *ngIf="contentType === 'youtube'">
                    <label class="block text-sm font-bold text-gray-700 mb-2">
                        <i class="fab fa-youtube text-red-600 ml-2"></i>
                        رابط YouTube
                        <span class="text-red-500">*</span>
                    </label>
                    <input type="url" [(ngModel)]="youtubeUrl"
                        class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-red-500 transition-all"
                        placeholder="https://www.youtube.com/watch?v=...">
                </div>

                <!-- PDF File Upload -->
                <div *ngIf="contentType === 'pdf'">
                    <label class="block text-sm font-bold text-gray-700 mb-2">
                        <i class="fas fa-file-pdf text-orange-600 ml-2"></i>
                        ملف PDF
                        <span class="text-red-500">*</span>
                    </label>
                    <div
                        class="border-2 border-dashed border-gray-300 rounded-xl p-6 text-center hover:border-orange-500 transition-all">
                        <input type="file" (change)="onPdfSelected($event)" accept=".pdf" class="hidden" #pdfInput>
                        <button (click)="pdfInput.click()" type="button"
                            class="flex flex-col items-center justify-center w-full">
                            <i class="fas fa-file-pdf text-5xl text-orange-400 mb-3"></i>
                            <span class="text-sm text-gray-600" *ngIf="!selectedPdfFile">اضغط لرفع ملف PDF</span>
                            <span class="text-sm text-orange-600 font-bold" *ngIf="selectedPdfFile">
                                <i class="fas fa-check-circle ml-1"></i>
                                {{selectedPdfFile.name}}
                            </span>
                        </button>
                    </div>
                </div>

                <!-- YouTube URL Input -->
                <div *ngIf="videoSource === 'youtube'">
                    <label class="block text-sm font-bold text-gray-700 mb-2">
                        <i class="fab fa-youtube text-red-600 ml-2"></i>
                        رابط YouTube
                        <span class="text-red-500">*</span>
                    </label>
                    <input type="url" [(ngModel)]="youtubeUrl"
                        class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-red-500 transition-all"
                        placeholder="https://www.youtube.com/watch?v=...">
                    <small class="text-gray-500 mt-1 block">الصق رابط الفيديو من YouTube</small>
                </div>

                <!-- File Upload (Local) -->
                <!-- <div *ngIf="videoSource === 'local'">
                    <label class="block text-sm font-bold text-gray-700 mb-2">
                        <i class="fas fa-video text-indigo-600 ml-2"></i>
                        ملف الفيديو
                        <span class="text-red-500">*</span>
                    </label>
                    <div
                        class="border-2 border-dashed border-gray-300 rounded-xl p-6 md:p-8 text-center hover:border-indigo-500 transition-all">
                        <input type="file" (change)="onFileSelected($event)" accept="video/*" class="hidden" #fileInput>
                        <button (click)="fileInput.click()" type="button"
                            class="flex flex-col items-center justify-center w-full">
                            <i class="fas fa-cloud-upload-alt text-5xl text-gray-400 mb-3"></i>
                            <span class="text-sm text-gray-600" *ngIf="!selectedFile">اضغط لرفع الفيديو أو اسحبه
                                هنا</span>
                            <span class="text-sm text-indigo-600 font-bold" *ngIf="selectedFile">
                                <i class="fas fa-check-circle ml-1"></i>
                                {{selectedFile.name}}
                            </span>
                        </button>
                    </div>
                    <small class="text-orange-500 mt-1 block">⚠️ رفع الفيديوهات المحلية قيد التطوير</small>
                </div> -->

                <!-- Title -->
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-2">
                        <i class="fas fa-heading text-blue-600 ml-2"></i>
                        عنوان الفيديو
                        <span class="text-red-500">*</span>
                    </label>
                    <input type="text" [(ngModel)]="newVideo.title"
                        class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-indigo-500 transition-all"
                        placeholder="أدخل عنوان الفيديو">
                </div>

                <!-- Description -->
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-2">
                        <i class="fas fa-align-right text-purple-600 ml-2"></i>
                        الوصف
                    </label>
                    <textarea [(ngModel)]="newVideo.description" rows="3"
                        class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-purple-500 transition-all"
                        placeholder="أدخل وصف الفيديو"></textarea>
                </div>

                <!-- Subject and Grade -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">
                            <i class="fas fa-book text-green-600 ml-2"></i>
                            المادة
                            <span class="text-red-500">*</span>
                        </label>
                        <select [(ngModel)]="newVideo.subject"
                            class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-green-500 transition-all">
                            <option value="">اختر المادة</option>
                            <option *ngFor="let subject of subjects" [value]="subject.name">{{subject.name}}</option>
                        </select>
                    </div>
                    <!-- في Upload Modal و Edit Modal -->
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">
                            <i class="fas fa-users text-orange-600 ml-2"></i>
                            المجموعة
                            <span class="text-red-500">*</span>
                        </label>
                        <select [(ngModel)]="newVideo.grade"
                            class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-orange-500 transition-all">
                            <option value="">اختر المجموعة</option>
                            <!-- ⬅️ تأكد إن group.id موجود -->
                            <option *ngFor="let group of groups" [value]="group.id">{{group.name}}</option>
                        </select>
                        <!-- ⬅️ أضف عرض القيمة للتأكد -->
                        <small class="text-gray-500">القيمة المختارة: {{newVideo.grade || 'لا يوجد'}}</small>
                    </div>
                </div>

                <!-- Category -->
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-3">
                        <i class="fas fa-tag text-pink-600 ml-2"></i>
                        نوع المحتوى
                        <span class="text-red-500">*</span>
                    </label>
                    <div class="grid grid-cols-2 gap-3">
                        <button type="button" (click)="newVideo.category = 'درس'"
                            [class.bg-indigo-600]="newVideo.category === 'درس'"
                            [class.text-white]="newVideo.category === 'درس'"
                            [class.bg-gray-100]="newVideo.category !== 'درس'"
                            [class.text-gray-700]="newVideo.category !== 'درس'"
                            class="px-4 py-3 rounded-xl font-bold transition-all border-2 hover:scale-105"
                            [class.border-indigo-600]="newVideo.category === 'درس'"
                            [class.border-gray-200]="newVideo.category !== 'درس'">
                            درس
                        </button>
                        <button type="button" (click)="newVideo.category = 'تجربة عملية'"
                            [class.bg-purple-600]="newVideo.category === 'تجربة عملية'"
                            [class.text-white]="newVideo.category === 'تجربة عملية'"
                            [class.bg-gray-100]="newVideo.category !== 'تجربة عملية'"
                            [class.text-gray-700]="newVideo.category !== 'تجربة عملية'"
                            class="px-4 py-3 rounded-xl font-bold transition-all border-2 hover:scale-105"
                            [class.border-purple-600]="newVideo.category === 'تجربة عملية'"
                            [class.border-gray-200]="newVideo.category !== 'تجربة عملية'">
                            تجربة عملية
                        </button>
                        <button type="button" (click)="newVideo.category = 'مراجعة'"
                            [class.bg-green-600]="newVideo.category === 'مراجعة'"
                            [class.text-white]="newVideo.category === 'مراجعة'"
                            [class.bg-gray-100]="newVideo.category !== 'مراجعة'"
                            [class.text-gray-700]="newVideo.category !== 'مراجعة'"
                            class="px-4 py-3 rounded-xl font-bold transition-all border-2 hover:scale-105"
                            [class.border-green-600]="newVideo.category === 'مراجعة'"
                            [class.border-gray-200]="newVideo.category !== 'مراجعة'">
                            مراجعة
                        </button>
                        <button type="button" (click)="newVideo.category = 'اختبار'"
                            [class.bg-orange-600]="newVideo.category === 'اختبار'"
                            [class.text-white]="newVideo.category === 'اختبار'"
                            [class.bg-gray-100]="newVideo.category !== 'اختبار'"
                            [class.text-gray-700]="newVideo.category !== 'اختبار'"
                            class="px-4 py-3 rounded-xl font-bold transition-all border-2 hover:scale-105"
                            [class.border-orange-600]="newVideo.category === 'اختبار'"
                            [class.border-gray-200]="newVideo.category !== 'اختبار'">
                            اختبار
                        </button>
                    </div>
                </div>

                <!-- Publish Option -->
                <div class="flex items-center gap-3 p-4 bg-gray-50 rounded-xl">
                    <input type="checkbox" [(ngModel)]="newVideo.isPublished" id="publishNow"
                        class="w-5 h-5 text-indigo-600 rounded focus:ring-indigo-500">
                    <label for="publishNow" class="text-sm font-bold text-gray-700 cursor-pointer">
                        نشر الفيديو فوراً
                    </label>
                </div>

                <!-- Free Content Option -->
                <div class="flex items-center gap-3 p-4 bg-green-50 rounded-xl border-2 border-green-200">
                    <input type="checkbox" [(ngModel)]="newVideo.isFree" id="isFree"
                        class="w-5 h-5 text-green-600 rounded focus:ring-green-500">
                    <label for="isFree" class="text-sm font-bold text-gray-700 cursor-pointer flex items-center gap-2">
                        <i class="fas fa-gift text-green-600"></i>
                        محتوى مجاني (متاح للجميع)
                    </label>
                </div>

                <!-- Upload Progress -->
                <div *ngIf="uploadProgress > 0" class="mt-4">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm font-bold text-gray-700">
                            <i class="fas fa-spinner fa-spin ml-2 text-indigo-600"></i>
                            جاري الرفع...
                        </span>
                        <span class="text-sm font-bold text-indigo-600">{{uploadProgress}}%</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-4 overflow-hidden">
                        <div class="bg-gradient-to-r from-indigo-600 to-purple-600 h-full transition-all duration-500 rounded-full"
                            [style.width.%]="uploadProgress"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Actions -->
        <div class="border-t border-gray-200 p-4 bg-gray-50 flex items-center gap-3">
            <button (click)="uploadVideo()" [disabled]="uploadProgress > 0 || isSaving"
                [class.opacity-50]="uploadProgress > 0 || isSaving"
                [class.cursor-not-allowed]="uploadProgress > 0 || isSaving"
                class="flex-1 bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-6 py-3 rounded-xl hover:shadow-lg transition-all font-bold flex items-center justify-center gap-2">
                <i class="fas" [class.fa-upload]="!isSaving" [class.fa-spinner]="isSaving"
                    [class.fa-spin]="isSaving"></i>
                <span>{{ isSaving ? 'جاري الرفع...' : 'رفع الفيديو' }}</span>
            </button>
            <button (click)="closeUploadModal()" [disabled]="uploadProgress > 0 || isSaving"
                class="px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-xl hover:bg-gray-100 transition-all font-bold">
                إلغاء
            </button>
        </div>
    </div>
</div>

<!-- View Video Modal -->
<div *ngIf="showViewModal && selectedVideo"
    class="fixed inset-0 bg-black/90 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-fadeIn"
    (click)="closeViewModal()">

    <div (click)="$event.stopPropagation()"
        class="bg-white rounded-3xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden animate-slideUp">

        <!-- Header -->
        <div class="bg-gradient-to-r from-purple-600 to-blue-600 p-6">
            <div class="flex items-center justify-between">
                <h2 class="text-2xl font-bold text-white">{{selectedVideo.title}}</h2>
                <button (click)="closeViewModal()"
                    class="w-10 h-10 bg-white/20 hover:bg-white/30 rounded-xl transition-all flex items-center justify-center">
                    <i class="fas fa-times text-white text-xl"></i>
                </button>
            </div>
        </div>

        <!-- Video Player -->
        <div class="p-6 overflow-y-auto max-h-[calc(90vh-200px)]">
            <div class="aspect-video bg-black rounded-xl overflow-hidden mb-6">

                <!-- ✅ YouTube Video -->
                <iframe *ngIf="!isPdf(selectedVideo) && isYouTubeVideo(selectedVideo.url)"
                    [src]="selectedVideo.url | safePipe: 'resourceUrl'" class="w-full h-full" frameborder="0"
                    allowfullscreen>
                </iframe>

                <!-- ✅ PDF Viewer -->
                <iframe *ngIf="isPdf(selectedVideo)" [src]="selectedVideo.url | safePipe: 'resourceUrl'"
                    class="w-full h-full" type="application/pdf">
                </iframe>

            </div>

            <!-- Video/PDF Info -->
            <div class="space-y-4">
                <div>
                    <h3 class="text-sm font-bold text-gray-500 mb-2">الوصف</h3>
                    <p class="text-gray-700">{{selectedVideo.description || 'لا يوجد وصف'}}</p>
                </div>

                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div class="bg-blue-50 p-4 rounded-xl">
                        <p class="text-xs text-blue-600 font-bold mb-1">المادة</p>
                        <p class="text-sm font-bold text-gray-800">{{selectedVideo.subject}}</p>
                    </div>
                    <div class="bg-purple-50 p-4 rounded-xl">
                        <p class="text-xs text-purple-600 font-bold mb-1">المجموعة</p>
                        <p class="text-sm font-bold text-gray-800">{{getGroupName(selectedVideo.grade)}}</p>
                    </div>
                    <div class="bg-green-50 p-4 rounded-xl">
                        <p class="text-xs text-green-600 font-bold mb-1">النوع</p>
                        <p class="text-sm font-bold text-gray-800">{{selectedVideo.category}}</p>
                    </div>
                    <div class="bg-orange-50 p-4 rounded-xl">
                        <!-- ✅ عرض عدد الصفحات للـ PDF -->
                        <p class="text-xs text-orange-600 font-bold mb-1">
                            {{isPdf(selectedVideo) ? 'عدد الصفحات' : 'المدة'}}
                        </p>
                        <p class="text-sm font-bold text-gray-800">{{selectedVideo.duration}}</p>
                    </div>
                </div>

                <!-- ✅ زر تحميل PDF -->
                <div *ngIf="isPdf(selectedVideo)" class="pt-4 border-t">
                    <a [href]="selectedVideo.url" download
                        class="flex items-center justify-center gap-2 px-6 py-3 bg-orange-600 text-white rounded-xl hover:bg-orange-700 transition-all font-bold">
                        <i class="fas fa-download"></i>
                        <span>تحميل PDF</span>
                    </a>
                </div>

                <!-- Existing likes/views section -->
                <div class="flex items-center justify-between pt-4 border-t">
                    <!-- ... existing code ... -->
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Edit Modal -->
<div *ngIf="showEditModal"
    class="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-fadeIn"
    (click)="closeEditModal()">

    <div (click)="$event.stopPropagation()"
        class="bg-white rounded-3xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden animate-slideUp">

        <!-- Header -->
        <div class="bg-gradient-to-r from-orange-600 to-red-600 p-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <div class="w-14 h-14 bg-white/20 backdrop-blur-xl rounded-2xl flex items-center justify-center">
                        <i class="fas fa-edit text-white text-2xl"></i>
                    </div>
                    <div>
                        <h2 class="text-2xl font-bold text-white">تعديل الفيديو</h2>
                        <p class="text-white/80 text-sm mt-1">قم بتحديث معلومات الفيديو</p>
                    </div>
                </div>
                <button (click)="closeEditModal()"
                    class="w-10 h-10 bg-white/20 hover:bg-white/30 rounded-xl transition-all flex items-center justify-center">
                    <i class="fas fa-times text-white text-xl"></i>
                </button>
            </div>
        </div>

        <!-- Form (نفس الحقول في Upload Modal بدون File Upload) -->
        <div class="p-6 overflow-y-auto max-h-[calc(90vh-200px)]">
            <div class="space-y-4">
                <!-- Title -->
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-2">
                        <i class="fas fa-heading text-blue-600 ml-2"></i>
                        عنوان الفيديو <span class="text-red-500">*</span>
                    </label>
                    <input type="text" [(ngModel)]="newVideo.title"
                        class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-blue-500 transition-all">
                </div>

                <!-- Description -->
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-2">
                        <i class="fas fa-align-right text-purple-600 ml-2"></i>
                        الوصف
                    </label>
                    <textarea [(ngModel)]="newVideo.description" rows="3"
                        class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-purple-500 transition-all"></textarea>
                </div>

                <!-- Subject and Grade -->
                <div class="grid grid-cols-2 gap-4">
                    <!-- المادة -->
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">
                            <i class="fas fa-book text-green-600 ml-2"></i>
                            المادة <span class="text-red-500">*</span>
                        </label>
                        <select [(ngModel)]="newVideo.subject"
                            class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-green-500 transition-all">
                            <option value="">اختر المادة</option>
                            <!-- ⬅️ غيرها من subject لـ subject.name -->
                            <option *ngFor="let subject of subjects" [value]="subject.name">{{subject.name}}</option>
                        </select>
                    </div>

                    <!-- المجموعة -->
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">
                            <i class="fas fa-users text-orange-600 ml-2"></i>
                            المجموعة <span class="text-red-500">*</span>
                        </label>
                        <select [(ngModel)]="newVideo.grade"
                            class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-orange-500 transition-all">
                            <option value="">اختر المجموعة</option>
                            <!-- ⬅️ ده صح -->
                            <option *ngFor="let group of groups" [value]="group.id">{{group.name}}</option>
                        </select>
                    </div>
                </div>

                <!-- Category -->
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-3">
                        <i class="fas fa-tag text-pink-600 ml-2"></i>
                        نوع المحتوى <span class="text-red-500">*</span>
                    </label>
                    <div class="grid grid-cols-2 gap-3">
                        <button type="button" (click)="newVideo.category = 'درس'"
                            [class.bg-indigo-600]="newVideo.category === 'درس'"
                            [class.text-white]="newVideo.category === 'درس'"
                            [class.bg-gray-100]="newVideo.category !== 'درس'"
                            class="px-4 py-3 rounded-xl font-bold transition-all border-2">
                            درس
                        </button>
                        <button type="button" (click)="newVideo.category = 'تجربة عملية'"
                            [class.bg-purple-600]="newVideo.category === 'تجربة عملية'"
                            [class.text-white]="newVideo.category === 'تجربة عملية'"
                            [class.bg-gray-100]="newVideo.category !== 'تجربة عملية'"
                            class="px-4 py-3 rounded-xl font-bold transition-all border-2">
                            تجربة عملية
                        </button>
                        <button type="button" (click)="newVideo.category = 'مراجعة'"
                            [class.bg-green-600]="newVideo.category === 'مراجعة'"
                            [class.text-white]="newVideo.category === 'مراجعة'"
                            [class.bg-gray-100]="newVideo.category !== 'مراجعة'"
                            class="px-4 py-3 rounded-xl font-bold transition-all border-2">
                            مراجعة
                        </button>
                        <button type="button" (click)="newVideo.category = 'اختبار'"
                            [class.bg-orange-600]="newVideo.category === 'اختبار'"
                            [class.text-white]="newVideo.category === 'اختبار'"
                            [class.bg-gray-100]="newVideo.category !== 'اختبار'"
                            class="px-4 py-3 rounded-xl font-bold transition-all border-2">
                            اختبار
                        </button>
                    </div>
                </div>

                <!-- Publish Option -->
                <div class="flex items-center gap-3 p-4 bg-gray-50 rounded-xl">
                    <input type="checkbox" [(ngModel)]="newVideo.isPublished" id="publishEdit"
                        class="w-5 h-5 text-indigo-600 rounded focus:ring-indigo-500">
                    <label for="publishEdit" class="text-sm font-bold text-gray-700 cursor-pointer">
                        نشر الفيديو
                    </label>
                </div>

                <!-- ✅ Free Content Option - أضف ده -->
                <div class="flex items-center gap-3 p-4 bg-green-50 rounded-xl border-2 border-green-200">
                    <input type="checkbox" [(ngModel)]="newVideo.isFree" id="isFreeEdit"
                        class="w-5 h-5 text-green-600 rounded focus:ring-green-500">
                    <label for="isFreeEdit"
                        class="text-sm font-bold text-gray-700 cursor-pointer flex items-center gap-2">
                        <i class="fas fa-gift text-green-600"></i>
                        محتوى مجاني (متاح للجميع)
                    </label>
                </div>
            </div>
        </div>

        <!-- Actions -->
        <div class="border-t border-gray-200 p-4 bg-gray-50 flex items-center gap-3">
            <button (click)="updateVideo()" [disabled]="isSaving" [class.opacity-50]="isSaving"
                [class.cursor-not-allowed]="isSaving"
                class="flex-1 bg-gradient-to-r from-orange-600 to-red-600 text-white px-6 py-3 rounded-xl hover:shadow-lg transition-all font-bold flex items-center justify-center gap-2">
                <i class="fas" [class.fa-save]="!isSaving" [class.fa-spinner]="isSaving" [class.fa-spin]="isSaving"></i>
                <span>{{ isSaving ? 'جاري الحفظ...' : 'حفظ التعديلات' }}</span>
            </button>
            <button (click)="closeEditModal()" [disabled]="isSaving"
                class="px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-xl hover:bg-gray-100 transition-all font-bold">
                إلغاء
            </button>
        </div>
    </div>
</div>

<!-- Delete Video Dialog -->
<div *ngIf="isDeleteDialogOpen"
    class="fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4 animate-fadeIn"
    style="backdrop-filter: blur(8px);" (click)="closeDeleteDialog()">

    <div (click)="$event.stopPropagation()"
        class="bg-white rounded-3xl shadow-2xl w-full max-w-md overflow-hidden animate-slideUp">

        <!-- Header -->
        <div class="bg-gradient-to-r from-red-600 to-rose-600 p-6">
            <div class="flex items-center justify-center">
                <div class="w-16 h-16 bg-white/20 backdrop-blur-xl rounded-full flex items-center justify-center">
                    <i class="fas fa-trash-alt text-white text-3xl"></i>
                </div>
            </div>
        </div>

        <!-- Content -->
        <div class="p-8 text-center">
            <h2 class="text-2xl font-bold text-gray-900 mb-3">تأكيد الحذف</h2>
            <p class="text-gray-600 mb-2">هل أنت متأكد من حذف هذا الفيديو؟</p>
            <p class="text-sm text-gray-500">لن تتمكن من استرجاعه بعد الحذف</p>

            <div *ngIf="videoToDelete" class="mt-4 p-4 bg-gray-50 rounded-xl text-right">
                <p class="font-semibold text-gray-800 mb-1">{{ videoToDelete.title }}</p>
                <div class="flex gap-2 mt-2 justify-center">
                    <span class="px-2 py-1 bg-blue-100 text-blue-700 rounded-full text-xs">
                        {{ videoToDelete.subject }}
                    </span>
                    <span class="px-2 py-1 bg-purple-100 text-purple-700 rounded-full text-xs">
                        {{ videoToDelete.category }}
                    </span>
                </div>
            </div>
        </div>

        <!-- Footer Actions -->
        <div class="border-t border-gray-200 p-4 flex items-center gap-3">
            <button (click)="confirmDeleteVideo()" [disabled]="isDeleting" [class.opacity-50]="isDeleting"
                [class.cursor-not-allowed]="isDeleting"
                class="flex-1 py-3 bg-gradient-to-r from-red-600 to-rose-600 text-white rounded-xl font-bold hover:shadow-lg transition-all flex items-center justify-center gap-2">
                <i class="fas" [class.fa-trash]="!isDeleting" [class.fa-spinner]="isDeleting"
                    [class.fa-spin]="isDeleting"></i>
                <span>{{ isDeleting ? 'جاري الحذف...' : 'تأكيد الحذف' }}</span>
            </button>
            <button (click)="closeDeleteDialog()" [disabled]="isDeleting"
                class="flex-1 py-3 bg-white border-2 border-gray-300 text-gray-700 rounded-xl font-bold hover:bg-gray-50 transition-all flex items-center justify-center gap-2">
                <i class="fas fa-times"></i>
                <span>إلغاء</span>
            </button>
        </div>
    </div>
</div>

<style>
    @keyframes fadeIn {
        from {
            opacity: 0;
        }

        to {
            opacity: 1;
        }
    }

    @keyframes slideUp {
        from {
            transform: translateY(30px);
            opacity: 0;
        }

        to {
            transform: translateY(0);
            opacity: 1;
        }
    }

    .animate-fadeIn {
        animation: fadeIn 0.2s ease-out;
    }

    .animate-slideUp {
        animation: slideUp 0.3s ease-out;
    }
</style>