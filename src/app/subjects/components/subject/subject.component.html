<!-- src/app/pages/subjects/subjects.component.html -->
<div class="subjects-container">

  <!-- Header Section -->
  <div class="page-header">
    <div class="header-content">
      <div class="title-section">
        <div class="icon-wrapper">
          <i class="fas fa-book"></i>
        </div>
        <div>
          <h1 class="page-title">ุฅุฏุงุฑุฉ ุงูููุงุฏ ุงูุฏุฑุงุณูุฉ</h1>
          <p class="page-subtitle">ุนุฑุถ ูุฅุฏุงุฑุฉ ุฌููุน ุงูููุงุฏ ุงูุฏุฑุงุณูุฉ</p>
        </div>
      </div>

      <button class="btn-primary" (click)="openAddModal()" *ngIf="userRole === 'Admin'">
        <i class="fas fa-plus ml-2"></i>
        ุฅุถุงูุฉ ูุงุฏุฉ ุฌุฏูุฏุฉ
      </button>
    </div>

    <!-- Stats Cards -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon bg-blue">
          <i class="fas fa-book"></i>
        </div>
        <div class="stat-info">
          <h3>{{ stats.totalSubjects }}</h3>
          <p>ุฅุฌูุงูู ุงูููุงุฏ</p>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon bg-green">
          <i class="fas fa-check-circle"></i>
        </div>
        <div class="stat-info">
          <h3>{{ stats.activeSubjects }}</h3>
          <p>ุงูููุงุฏ ุงููุดุทุฉ</p>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon bg-orange">
          <i class="fas fa-pause-circle"></i>
        </div>
        <div class="stat-info">
          <h3>{{ stats.inactiveSubjects }}</h3>
          <p>ุงูููุงุฏ ุงููุชูููุฉ</p>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon bg-purple">
          <i class="fas fa-users"></i>
        </div>
        <div class="stat-info">
          <h3>{{ stats.totalEnrollments }}</h3>
          <p>ุฅุฌูุงูู ุงูุงุดุชุฑุงูุงุช</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Filters Section -->
  <div class="filters-section">
    <div class="search-box">
      <i class="fas fa-search"></i>
      <input type="text" placeholder="ุงูุจุญุซ ุนู ูุงุฏุฉ..." [(ngModel)]="searchText" (input)="onSearch()">
    </div>

    <div class="filter-buttons">
      <button class="filter-btn" [class.active]="selectedFilter === 'all'" (click)="filterSubjects('all')">
        <i class="fas fa-list ml-2"></i>
        ุงููู
      </button>
      <button class="filter-btn" [class.active]="selectedFilter === 'active'" (click)="filterSubjects('active')">
        <i class="fas fa-check-circle ml-2"></i>
        ุงููุดุทุฉ
      </button>
      <button class="filter-btn" [class.active]="selectedFilter === 'inactive'" (click)="filterSubjects('inactive')">
        <i class="fas fa-pause-circle ml-2"></i>
        ุงููุชูููุฉ
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="isLoading">
    <div class="spinner"></div>
    <p>ุฌุงุฑู ุงูุชุญููู...</p>
  </div>

  <!-- Subjects Grid -->
  <div class="subjects-grid" *ngIf="!isLoading && filteredSubjects.length > 0">
    <div class="subject-card" *ngFor="let subject of filteredSubjects">

      <!-- Card Header -->
      <div class="card-header" [style.background]="subject.color || '#6366f1'">
        <div class="subject-icon">
          <i [class]="subject.icon || 'fas fa-book'"></i>
        </div>
        <div class="card-status">
          <span class="status-badge" [class.active]="subject.isActive">
            {{ subject.isActive ? 'ูุดุท' : 'ูุชููู' }}
          </span>
        </div>
      </div>

      <!-- Card Body -->
      <div class="card-body">
        <h3 class="subject-name">{{ subject.name }}</h3>
        <p class="subject-code" *ngIf="subject.code">{{ subject.code }}</p>
        <p class="subject-description">{{ subject.description || 'ูุง ููุฌุฏ ูุตู' }}</p>

        <!-- Stats -->
        <div class="subject-stats" *ngIf="userRole === 'Admin' || userRole === 'Assistant' ">
          <div class="stat-item">
            <i class="fas fa-user-graduate"></i>
            <span>{{ subject.totalStudents }} ุทุงูุจ</span>
          </div>
          <div class="stat-item">
            <i class="fas fa-chalkboard-teacher"></i>
            <span>{{ subject.totalTeachers }} ูุฏุฑุณ</span>
          </div>
        </div>

        <!-- Created Date -->
        <div class="subject-date">
          <i class="fas fa-calendar ml-2"></i>
          ุชู ุงูุฅูุดุงุก: {{ subject.createdAt | date: 'dd/MM/yyyy' }}
        </div>
      </div>

      <!-- Card Actions -->
      <div class="card-actions" *ngIf="userRole === 'Admin' || userRole === 'Assistant' ">
        <button class="btn-action view" (click)="viewSubjectUsers(subject)" title="ุนุฑุถ ุงูุทูุงุจ">
          <i class="fas fa-users"></i>
        </button>
        <button class="btn-action edit" (click)="openEditModal(subject)" *ngIf="userRole === 'Admin'" title="ุชุนุฏูู">
          <i class="fas fa-edit"></i>
        </button>
        <button class="btn-action delete" (click)="openDeleteDialog(subject)"  *ngIf="userRole === 'Admin'" title="ุญุฐู">
          <i class="fas fa-trash"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div class="empty-state" *ngIf="!isLoading && filteredSubjects.length === 0">
    <i class="fas fa-inbox"></i>
    <h3>ูุง ุชูุฌุฏ ููุงุฏ</h3>
    <p>ูู ูุชู ุงูุนุซูุฑ ุนูู ุฃู ููุงุฏ ุฏุฑุงุณูุฉ</p>
    <button class="btn-primary" (click)="openAddModal()" *ngIf="userRole === 'Admin'">
      <i class="fas fa-plus ml-2"></i>
      ุฅุถุงูุฉ ูุงุฏุฉ ุฌุฏูุฏุฉ
    </button>
  </div>

</div>

<!-- Add/Edit Modal -->
<div class="modal-overlay" *ngIf="showModal" (click)="closeModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">

    <!-- Modal Header -->
    <div class="modal-header">
      <div class="modal-title-section">
        <div class="modal-icon">
          <i class="fas fa-book"></i>
        </div>
        <div>
          <h2>{{ isEditMode ? 'ุชุนุฏูู ุงููุงุฏุฉ' : 'ุฅุถุงูุฉ ูุงุฏุฉ ุฌุฏูุฏุฉ' }}</h2>
          <p>{{ isEditMode ? 'ุชุนุฏูู ุจูุงูุงุช ุงููุงุฏุฉ ุงูุฏุฑุงุณูุฉ' : 'ุฅุถุงูุฉ ูุงุฏุฉ ุฏุฑุงุณูุฉ ุฌุฏูุฏุฉ' }}</p>
        </div>
      </div>
      <button class="btn-close" (click)="closeModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <!-- Modal Body -->
    <div class="modal-body">
      <form [formGroup]="subjectForm">

        <!-- Subject Name -->
        <div class="form-group">
          <label>
            <i class="fas fa-book ml-2"></i>
            ุงุณู ุงููุงุฏุฉ
            <span class="required">*</span>
          </label>
          <input type="text" formControlName="name" placeholder="ูุซุงู: ุงูุฑูุงุถูุงุช" class="form-control"
            [class.error]="subjectForm.get('name')?.invalid && subjectForm.get('name')?.touched">
          <span class="error-message" *ngIf="subjectForm.get('name')?.invalid && subjectForm.get('name')?.touched">
            ุงุณู ุงููุงุฏุฉ ูุทููุจ
          </span>
        </div>

        <!-- Subject Code -->
        <div class="form-group">
          <label>
            <i class="fas fa-code ml-2"></i>
            ููุฏ ุงููุงุฏุฉ
          </label>
          <input type="text" formControlName="code" placeholder="ูุซุงู: MATH101" class="form-control">
        </div>

        <!-- Description -->
        <div class="form-group">
          <label>
            <i class="fas fa-align-right ml-2"></i>
            ุงููุตู
          </label>
          <textarea formControlName="description" placeholder="ูุตู ุงููุงุฏุฉ..." class="form-control" rows="4"></textarea>
        </div>

        <!-- Color & Icon Row -->
        <div class="form-row">

          <!-- Color Picker -->
          <div class="form-group">
            <label>
              <i class="fas fa-palette ml-2"></i>
              ุงูููู
            </label>
            <div class="color-picker">
              <input type="color" formControlName="color" class="color-input">
              <span class="color-value">{{ subjectForm.get('color')?.value }}</span>
            </div>
          </div>

          <!-- Icon Selector -->
          <div class="form-group">
            <label>
              <i class="fas fa-icons ml-2"></i>
              ุงูุฃููููุฉ
            </label>
            <select formControlName="icon" class="form-control">
              <option value="fas fa-book">๐ ูุชุงุจ</option>
              <option value="fas fa-calculator">๐งฎ ุขูุฉ ุญุงุณุจุฉ</option>
              <option value="fas fa-flask">๐งช ูุงุฑูุฑุฉ</option>
              <option value="fas fa-atom">โ๏ธ ุฐุฑุฉ</option>
              <option value="fas fa-globe">๐ ูุฑุฉ ุฃุฑุถูุฉ</option>
              <option value="fas fa-language">๐ค ูุบุฉ</option>
              <option value="fas fa-paint-brush">๐จ ูุฑุดุงุฉ</option>
              <option value="fas fa-music">๐ต ููุณููู</option>
            </select>
          </div>
        </div>

        <!-- Active Status -->
        <div class="form-group checkbox-group">
          <label class="checkbox-label">
            <input type="checkbox" formControlName="isActive">
            <span class="checkmark"></span>
            <span class="label-text">ุงููุงุฏุฉ ูุดุทุฉ</span>
          </label>
        </div>

      </form>
    </div>

    <!-- Modal Footer -->
    <div class="modal-footer">
      <button class="btn-secondary" (click)="closeModal()" [disabled]="isSaving">
        ุฅูุบุงุก
      </button>
      <button class="btn-primary" (click)="saveSubject()" [disabled]="subjectForm.invalid || isSaving">
        <i class="fas fa-spinner fa-spin ml-2" *ngIf="isSaving"></i>
        <i class="fas fa-save ml-2" *ngIf="!isSaving"></i>
        {{ isSaving ? 'ุฌุงุฑู ุงูุญูุธ...' : (isEditMode ? 'ุญูุธ ุงูุชุนุฏููุงุช' : 'ุฅุถุงูุฉ ุงููุงุฏุฉ') }}
      </button>
    </div>

  </div>
</div>

<!-- View Users Modal -->
<div class="modal-overlay" *ngIf="showUsersModal" (click)="closeUsersModal()">
  <div class="modal-content large" (click)="$event.stopPropagation()">

    <!-- Modal Header -->
    <div class="modal-header">
      <div class="modal-title-section">
        <div class="modal-icon">
          <i class="fas fa-users"></i>
        </div>
        <div>
          <h2>ุงููุณุชุฎุฏููู ุงููุณุฌููู</h2>
          <p>{{ selectedSubject?.name }}</p>
        </div>
      </div>
      <button class="btn-close" (click)="closeUsersModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <!-- Modal Body -->
    <div class="modal-body">

      <!-- Loading -->
      <div class="loading-container" *ngIf="isLoadingUsers">
        <div class="spinner"></div>
        <p>ุฌุงุฑู ุงูุชุญููู...</p>
      </div>

      <!-- Users Table -->
      <div class="table-container" *ngIf="!isLoadingUsers && subjectUsers.length > 0">
        <table class="users-table">
          <thead>
            <tr>
              <th>ุงูุงุณู ุงููุงูู</th>
              <th>ุงุณู ุงููุณุชุฎุฏู</th>
              <th>ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</th>
              <th>ุงูุฏูุฑ</th>
              <th>ุชุงุฑูุฎ ุงูุชุณุฌูู</th>
              <th>ุงูุญุงูุฉ</th>
              <th *ngIf="userRole === 'Admin'">ุฅุฌุฑุงุกุงุช</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let user of subjectUsers">
              <td>{{ user.fullName }}</td>
              <td>{{ user.userName }}</td>
              <td>{{ user.email }}</td>
              <td>
                <span class="role-badge" [class]="getRoleClass(user.role)">
                  {{ getRoleText(user.role) }}
                </span>
              </td>
              <td>{{ user.enrolledAt | date: 'dd/MM/yyyy' }}</td>
              <td>
                <span class="status-badge" [class.active]="user.isActive">
                  {{ user.isActive ? 'ูุดุท' : 'ุบูุฑ ูุดุท' }}
                </span>
              </td>
              <td *ngIf="userRole === 'Admin'">
                <button class="btn-action delete" (click)="openRemoveUserDialog(user)" title="ุฅุฒุงูุฉ">
                  <i class="fas fa-trash"></i>
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Empty State -->
      <div class="empty-state" *ngIf="!isLoadingUsers && subjectUsers.length === 0">
        <i class="fas fa-users-slash"></i>
        <h3>ูุง ููุฌุฏ ูุณุชุฎุฏููู</h3>
        <p>ูู ูุชู ุชุณุฌูู ุฃู ูุณุชุฎุฏููู ูู ูุฐู ุงููุงุฏุฉ ุจุนุฏ</p>
      </div>

    </div>

  </div>
</div>


<!-- Delete Subject Dialog -->
<div *ngIf="isDeleteDialogOpen"
    class="fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4 animate-fadeIn"
    style="backdrop-filter: blur(8px);" (click)="closeDeleteDialog()">

    <div (click)="$event.stopPropagation()"
        class="bg-white rounded-3xl shadow-2xl w-full max-w-md overflow-hidden animate-slideUp">

        <!-- Header -->
        <div class="bg-gradient-to-r from-red-600 to-rose-600 p-6">
            <div class="flex items-center justify-center">
                <div class="w-16 h-16 bg-white/20 backdrop-blur-xl rounded-full flex items-center justify-center">
                    <i class="fas fa-trash-alt text-white text-3xl"></i>
                </div>
            </div>
        </div>

        <!-- Content -->
        <div class="p-8 text-center">
            <h2 class="text-2xl font-bold text-gray-900 mb-3">ุชุฃููุฏ ุงูุญุฐู</h2>
            <p class="text-gray-600 mb-2">ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐู ุงููุงุฏุฉุ</p>
            <p class="text-sm text-gray-500">ูู ุชุชููู ูู ุงุณุชุฑุฌุงุนูุง ุจุนุฏ ุงูุญุฐู</p>

            <div *ngIf="subjectToDelete" class="mt-4 p-4 bg-gray-50 rounded-xl text-right">
                <p class="font-semibold text-gray-800 mb-1">{{ subjectToDelete.name }}</p>
                <p class="text-sm text-gray-500" *ngIf="subjectToDelete.code">ููุฏ: {{ subjectToDelete.code }}</p>
            </div>
        </div>

        <!-- Footer Actions -->
        <div class="border-t border-gray-200 p-4 flex items-center gap-3">
            <button (click)="confirmDeleteSubject()" [disabled]="isDeleting" [class.opacity-50]="isDeleting"
                [class.cursor-not-allowed]="isDeleting"
                class="flex-1 py-3 bg-gradient-to-r from-red-600 to-rose-600 text-white rounded-xl font-bold hover:shadow-lg transition-all flex items-center justify-center gap-2">
                <i class="fas" [class.fa-trash]="!isDeleting" [class.fa-spinner]="isDeleting"
                    [class.fa-spin]="isDeleting"></i>
                <span>{{ isDeleting ? 'ุฌุงุฑู ุงูุญุฐู...' : 'ุชุฃููุฏ ุงูุญุฐู' }}</span>
            </button>
            <button (click)="closeDeleteDialog()" [disabled]="isDeleting"
                class="flex-1 py-3 bg-white border-2 border-gray-300 text-gray-700 rounded-xl font-bold hover:bg-gray-50 transition-all flex items-center justify-center gap-2">
                <i class="fas fa-times"></i>
                <span>ุฅูุบุงุก</span>
            </button>
        </div>
    </div>
</div>

<!-- Remove User Dialog -->
<div *ngIf="isDeleteUserDialogOpen"
    class="fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4 animate-fadeIn"
    style="backdrop-filter: blur(8px);" (click)="closeRemoveUserDialog()">

    <div (click)="$event.stopPropagation()"
        class="bg-white rounded-3xl shadow-2xl w-full max-w-md overflow-hidden animate-slideUp">

        <!-- Header -->
        <div class="bg-gradient-to-r from-orange-600 to-red-600 p-6">
            <div class="flex items-center justify-center">
                <div class="w-16 h-16 bg-white/20 backdrop-blur-xl rounded-full flex items-center justify-center">
                    <i class="fas fa-user-times text-white text-3xl"></i>
                </div>
            </div>
        </div>

        <!-- Content -->
        <div class="p-8 text-center">
            <h2 class="text-2xl font-bold text-gray-900 mb-3">ุชุฃููุฏ ุงูุฅุฒุงูุฉ</h2>
            <p class="text-gray-600 mb-2">ูู ุฃูุช ูุชุฃูุฏ ูู ุฅุฒุงูุฉ ูุฐุง ุงููุณุชุฎุฏู ูู ุงููุงุฏุฉุ</p>
            <p class="text-sm text-gray-500">ุณูุชู ุฅูุบุงุก ุชุณุฌููู ูู ุงููุงุฏุฉ</p>

            <div *ngIf="userToRemove" class="mt-4 p-4 bg-gray-50 rounded-xl text-right">
                <p class="font-semibold text-gray-800 mb-1">{{ userToRemove.fullName }}</p>
                <p class="text-sm text-gray-500">{{ userToRemove.email }}</p>
                <span class="inline-block mt-2 px-3 py-1 rounded-full text-xs font-bold"
                    [class]="getRoleClass(userToRemove.role)">
                    {{ getRoleText(userToRemove.role) }}
                </span>
            </div>
        </div>

        <!-- Footer Actions -->
        <div class="border-t border-gray-200 p-4 flex items-center gap-3">
            <button (click)="confirmRemoveUser()" [disabled]="isDeleting" [class.opacity-50]="isDeleting"
                [class.cursor-not-allowed]="isDeleting"
                class="flex-1 py-3 bg-gradient-to-r from-orange-600 to-red-600 text-white rounded-xl font-bold hover:shadow-lg transition-all flex items-center justify-center gap-2">
                <i class="fas" [class.fa-user-times]="!isDeleting" [class.fa-spinner]="isDeleting"
                    [class.fa-spin]="isDeleting"></i>
                <span>{{ isDeleting ? 'ุฌุงุฑู ุงูุฅุฒุงูุฉ...' : 'ุชุฃููุฏ ุงูุฅุฒุงูุฉ' }}</span>
            </button>
            <button (click)="closeRemoveUserDialog()" [disabled]="isDeleting"
                class="flex-1 py-3 bg-white border-2 border-gray-300 text-gray-700 rounded-xl font-bold hover:bg-gray-50 transition-all flex items-center justify-center gap-2">
                <i class="fas fa-times"></i>
                <span>ุฅูุบุงุก</span>
            </button>
        </div>
    </div>
</div>