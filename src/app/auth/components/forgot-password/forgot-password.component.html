<app-loader-component *ngIf="loader"></app-loader-component>

<div class="min-h-screen flex items-center justify-center p-4 relative overflow-hidden">

    <!-- Aurora Background -->
    <div class="aurora"></div>

    <!-- Floating Particles -->
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>

    <!-- Forgot Password Card -->
    <div class="glass-card rounded-3xl w-full max-w-md p-8 relative z-10 bg-cyan-950">

        <!-- Step 1: Enter Email -->
        <div *ngIf="currentStep === 1" class="step-content">
            <div class="text-center mb-8 animate-slide-up">
                <div class="logo-wrapper">
                    <div class="logo-circle">
                        <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" class="text-white">
                            <path
                                d="m21 2-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0 3 3L22 7l-3-3m-3.5 3.5L19 4" />
                        </svg>
                    </div>
                </div>
                <h1 class="text-3xl font-bold text-white mb-2">ูุณูุช ูููุฉ ุงููุฑูุฑุ</h1>
                <p class="text-white/70">ุฃุฏุฎู ุจุฑูุฏู ุงูุฅููุชุฑููู ูุณูุฑุณู ูู ููุฏ ุงูุชุญูู</p>
            </div>

            <form [formGroup]="emailForm" (ngSubmit)="sendResetCode()" class="space-y-5">
                <div class="relative group animate-slide-up delay-1">
                    <div class="relative">
                        <div
                            class="absolute right-4 top-1/2 -translate-y-1/2 text-white/50 group-hover:text-purple-400 transition-all duration-300 group-focus-within:text-purple-400 pointer-events-none">
                            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2">
                                <rect width="20" height="16" x="2" y="4" rx="2" />
                                <path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7" />
                            </svg>
                        </div>
                        <input type="email" placeholder="ุงูุจุฑูุฏ ุงูุฅููุชุฑููู" formControlName="email"
                            class="w-full py-4 pr-12 pl-4 bg-white/10 border-2 text-center border-white/20 rounded-2xl text-white placeholder:text-white/50 backdrop-blur-xl focus:outline-none focus:border-purple-500/80 focus:bg-white/15 transition-all duration-300 hover:border-white/30">
                    </div>
                    <div class="error-msg" *ngIf="emailForm.get('email')?.invalid && emailForm.get('email')?.touched">
                        ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ูุทููุจ ุฃู ุบูุฑ ุตุงูุญ
                    </div>
                </div>

                <button type="submit" class="btn-login animate-slide-up delay-2"
                    [disabled]="emailForm.invalid || loader">
                    <span *ngIf="!loader" class="flex items-center justify-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2">
                            <line x1="22" x2="11" y1="2" y2="13" />
                            <polygon points="22 2 15 22 11 13 2 9 22 2" />
                        </svg>
                        ุฅุฑุณุงู ููุฏ ุงูุชุญูู
                    </span>
                    <span *ngIf="loader" class="flex items-center justify-center gap-2">
                        <div class="spinner"></div>
                        ุฌุงุฑู ุงูุฅุฑุณุงู...
                    </span>
                </button>

                <p class="text-center text-white/70 mt-6 animate-slide-up delay-3">
                    <a routerLink="/auth/login" class="link-animated flex items-center justify-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2">
                            <path d="m12 19-7-7 7-7" />
                            <path d="M19 12H5" />
                        </svg>
                        ุงูุนูุฏุฉ ูุชุณุฌูู ุงูุฏุฎูู
                    </a>
                </p>
            </form>
        </div>

        <!-- Step 2: Enter OTP -->
        <div *ngIf="currentStep === 2" class="step-content">
            <div class="text-center mb-8 animate-slide-up">
                <div class="logo-wrapper">
                    <div class="logo-circle success">
                        <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" class="text-white">
                            <rect width="20" height="16" x="2" y="4" rx="2" />
                            <path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7" />
                        </svg>
                    </div>
                </div>
                <h1 class="text-3xl font-bold text-white mb-2">ุฃุฏุฎู ููุฏ ุงูุชุญูู</h1>
                <p class="text-white/70">ุชู ุฅุฑุณุงู ููุฏ ูููู ูู 6 ุฃุฑูุงู ุฅูู</p>
                <p class="text-cyan-400 font-semibold mt-1">{{ userEmail }}</p>
            </div>

            <form [formGroup]="otpForm" (ngSubmit)="verifyCode()" class="space-y-6">
                <div class="otp-container animate-slide-up delay-1" dir="ltr">
                    <input *ngFor="let i of [0,1,2,3,4,5]" type="text" maxlength="1" class="otp-input"
                        [class.filled]="otpValues[i]" [value]="otpValues[i]" (input)="onOtpInput($event, i)"
                        (keydown)="onOtpKeydown($event, i)" (paste)="onOtpPaste($event)" #otpInputs>
                </div>

                <div class="text-center animate-slide-up delay-2">
                    <p class="text-white/60 text-sm" *ngIf="resendTimer > 0">
                        ููููู ุฅุนุงุฏุฉ ุงูุฅุฑุณุงู ุจุนุฏ
                        <span class="text-cyan-400 font-bold">{{ resendTimer }}</span>
                        ุซุงููุฉ
                    </p>
                    <button type="button" class="link-animated text-cyan-400" *ngIf="resendTimer === 0"
                        (click)="resendCode()">
                        ุฅุนุงุฏุฉ ุฅุฑุณุงู ุงูููุฏ
                    </button>
                </div>

                <button type="submit" class="btn-login animate-slide-up delay-3"
                    [disabled]="!isOtpComplete() || loader">
                    <span *ngIf="!loader" class="flex items-center justify-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
                            <polyline points="22 4 12 14.01 9 11.01" />
                        </svg>
                        ุชุญูู ูู ุงูููุฏ
                    </span>
                    <span *ngIf="loader" class="flex items-center justify-center gap-2">
                        <div class="spinner"></div>
                        ุฌุงุฑู ุงูุชุญูู...
                    </span>
                </button>

                <button type="button" class="btn-secondary animate-slide-up delay-4" (click)="goBack()">
                    ุชุบููุฑ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
                </button>
            </form>
        </div>

        <!-- Step 3: New Password -->
        <div *ngIf="currentStep === 3" class="step-content">
            <div class="text-center mb-8 animate-slide-up">
                <div class="logo-wrapper">
                    <div class="logo-circle">
                        <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" class="text-white">
                            <rect width="18" height="11" x="3" y="11" rx="2" ry="2" />
                            <path d="M7 11V7a5 5 0 0 1 10 0v4" />
                        </svg>
                    </div>
                </div>
                <h1 class="text-3xl font-bold text-white mb-2">ูููุฉ ูุฑูุฑ ุฌุฏูุฏุฉ</h1>
                <p class="text-white/70">ุฃุฏุฎู ูููุฉ ุงููุฑูุฑ ุงูุฌุฏูุฏุฉ</p>
            </div>

            <form [formGroup]="passwordForm" (ngSubmit)="resetPassword()" class="space-y-5">
                <div class="relative group animate-slide-up delay-1">
                    <div class="relative">
                        <div
                            class="absolute right-4 top-1/2 -translate-y-1/2 text-white/50 group-hover:text-pink-400 transition-all duration-300 group-focus-within:text-pink-400 pointer-events-none">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2">
                                <rect width="18" height="11" x="3" y="11" rx="2" ry="2" />
                                <path d="M7 11V7a5 5 0 0 1 10 0v4" />
                            </svg>
                        </div>
                        <input [type]="showPassword ? 'text' : 'password'" placeholder="ูููุฉ ุงููุฑูุฑ ุงูุฌุฏูุฏุฉ"
                            formControlName="newPassword" (input)="checkPasswordStrength()"
                            class="w-full py-4 pr-12 pl-12 bg-white/10 border-2 border-white/20 rounded-2xl text-white placeholder:text-white/50 backdrop-blur-xl focus:outline-none focus:border-pink-500/80 text-center focus:bg-white/15 transition-all duration-300 hover:border-white/30">
                        <button type="button"
                            class="absolute left-4 top-1/2 -translate-y-1/2 text-white/50 hover:text-white transition-all duration-300"
                            (click)="togglePassword()">
                            <svg *ngIf="!showPassword" xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z" />
                                <circle cx="12" cy="12" r="3" />
                            </svg>
                            <svg *ngIf="showPassword" xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M9.88 9.88a3 3 0 1 0 4.24 4.24" />
                                <path
                                    d="M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68" />
                                <path d="M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61" />
                                <line x1="2" x2="22" y1="2" y2="22" />
                            </svg>
                        </button>
                    </div>
                    <div class="password-strength mt-2" *ngIf="passwordForm.get('newPassword')?.value">
                        <div class="strength-bar">
                            <div class="strength-fill" [class]="passwordStrength"></div>
                        </div>
                        <span class="strength-text" [class]="passwordStrength">{{ passwordStrengthText }}</span>
                    </div>
                </div>

                <div class="relative group animate-slide-up delay-2">
                    <div class="relative">
                        <div
                            class="absolute right-4 top-1/2 -translate-y-1/2 text-white/50 group-hover:text-pink-400 transition-all duration-300 group-focus-within:text-pink-400 pointer-events-none">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2">
                                <rect width="18" height="11" x="3" y="11" rx="2" ry="2" />
                                <path d="M7 11V7a5 5 0 0 1 10 0v4" />
                            </svg>
                        </div>
                        <input [type]="showConfirmPassword ? 'text' : 'password'" placeholder="ุชุฃููุฏ ูููุฉ ุงููุฑูุฑ"
                            formControlName="confirmPassword"
                            class="w-full py-4 pr-12 pl-12 bg-white/10 border-2 border-white/20 rounded-2xl text-white placeholder:text-white/50 backdrop-blur-xl focus:outline-none focus:border-pink-500/80 text-center focus:bg-white/15 transition-all duration-300 hover:border-white/30">
                        <button type="button"
                            class="absolute left-4 top-1/2 -translate-y-1/2 text-white/50 hover:text-white transition-all duration-300"
                            (click)="toggleConfirmPassword()">
                            <svg *ngIf="!showConfirmPassword" xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z" />
                                <circle cx="12" cy="12" r="3" />
                            </svg>
                            <svg *ngIf="showConfirmPassword" xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M9.88 9.88a3 3 0 1 0 4.24 4.24" />
                                <path
                                    d="M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68" />
                                <path d="M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61" />
                                <line x1="2" x2="22" y1="2" y2="22" />
                            </svg>
                        </button>
                    </div>
                    <div class="error-msg"
                        *ngIf="passwordForm.hasError('passwordMismatch') && passwordForm.get('confirmPassword')?.touched">
                        ูููุฉ ุงููุฑูุฑ ุบูุฑ ูุชุทุงุจูุฉ
                    </div>
                </div>

                <button type="submit" class="btn-login animate-slide-up delay-3"
                    [disabled]="passwordForm.invalid || loader">
                    <span *ngIf="!loader" class="flex items-center justify-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2">
                            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" />
                            <polyline points="17 21 17 13 7 13 7 21" />
                            <polyline points="7 3 7 8 15 8" />
                        </svg>
                        ุญูุธ ูููุฉ ุงููุฑูุฑ
                    </span>
                    <span *ngIf="loader" class="flex items-center justify-center gap-2">
                        <div class="spinner"></div>
                        ุฌุงุฑู ุงูุญูุธ...
                    </span>
                </button>
            </form>
        </div>

        <!-- Step 4: Success -->
        <div *ngIf="currentStep === 4" class="step-content text-center">
            <div class="animate-slide-up">
                <div class="success-checkmark mb-6">
                    <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="3" class="text-white">
                        <polyline points="20 6 9 17 4 12" />
                    </svg>
                </div>
                <h1 class="text-3xl font-bold text-white mb-3">ุชู ุจูุฌุงุญ! ๐</h1>
                <p class="text-white/70 mb-8">ุชู ุชุบููุฑ ูููุฉ ุงููุฑูุฑ ุจูุฌุงุญ</p>

                <a routerLink="/auth/login" class="btn-login inline-flex items-center justify-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2">
                        <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4" />
                        <polyline points="10 17 15 12 10 7" />
                        <line x1="15" x2="3" y1="12" y2="12" />
                    </svg>
                    ุชุณุฌูู ุงูุฏุฎูู ุงูุขู
                </a>
            </div>
        </div>

        <!-- Progress Indicator -->
        <div class="progress-indicator mt-8" *ngIf="currentStep < 4">
            <div class="progress-dots">
                <div class="dot" [class.active]="currentStep >= 1" [class.completed]="currentStep > 1"></div>
                <div class="line" [class.active]="currentStep > 1"></div>
                <div class="dot" [class.active]="currentStep >= 2" [class.completed]="currentStep > 2"></div>
                <div class="line" [class.active]="currentStep > 2"></div>
                <div class="dot" [class.active]="currentStep >= 3"></div>
            </div>
        </div>
    </div>
</div>