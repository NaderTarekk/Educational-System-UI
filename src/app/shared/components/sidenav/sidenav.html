<!-- sidenav.component.html -->
<aside [ngClass]="{
        'sidenav-open': (sidenavService.isOpen$ | async),
        'sidenav-closed': !(sidenavService.isOpen$ | async) && !isMobile,
        'sidenav-mobile-open': (sidenavService.isOpen$ | async) && isMobile,
        'sidenav-mobile-closed': !(sidenavService.isOpen$ | async) && isMobile
    }" class="sidenav-container">

    <div class="flex flex-col h-full">
        <!-- Header -->
        <div class="sidenav-header">
            <div class="header-content">
                <!-- Logo - Full -->
                <div *ngIf="(sidenavService.isOpen$ | async)" class="logo-full">
                    <div class="logo-icon">
                        <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5"
                                d="M13 10V3L4 14h7v7l9-11h-7z" />
                        </svg>
                    </div>
                    <div class="logo-text">
                        <h2>لوحة التحكم</h2>
                        <p>إدارة شاملة</p>
                    </div>
                </div>

                <!-- Logo - Collapsed (Desktop Only) -->
                <div *ngIf="!(sidenavService.isOpen$ | async) && !isMobile" class="logo-collapsed">
                    <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5"
                            d="M13 10V3L4 14h7v7l9-11h-7z" />
                    </svg>
                </div>

                <!-- Close Button (Mobile Only) -->
                <button *ngIf="isMobile && (sidenavService.isOpen$ | async)" (click)="sidenavService.close()"
                    class="close-btn">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5"
                            d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div class="header-line"></div>
        </div>

        <!-- Navigation Items -->
        <nav class="nav-container custom-scrollbar" #navContainer>

            <!-- Sliding Highlight -->
            <div class="nav-highlight" [style.top.px]="highlightTop" [style.height.px]="highlightHeight"
                [style.opacity]="highlightVisible ? 1 : 0" [style.background]="highlightGradient">
            </div>

            <!-- Dashboard -->
            <a routerLink="/dashboard" routerLinkActive="active-link" [routerLinkActiveOptions]="{ exact: true }"
                [attr.data-gradient]="'linear-gradient(135deg, #3b82f6, #2563eb)'" class="nav-item"
                [class.nav-item-collapsed]="!(sidenavService.isOpen$ | async) && !isMobile"
                (mouseenter)="onNavHover($event)" (mouseleave)="onNavLeave()">
                <div class="nav-icon bg-blue-100">
                    <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                    </svg>
                </div>
                <span *ngIf="(sidenavService.isOpen$ | async) || isMobile" class="nav-text">الرئيسية</span>
            </a>

            <!-- المستخدمين -->
            <a routerLink="/users" *ngIf="role !== 'Student'" routerLinkActive="active-link"
                [attr.data-gradient]="'linear-gradient(135deg, #10b981, #059669)'" class="nav-item"
                [class.nav-item-collapsed]="!(sidenavService.isOpen$ | async) && !isMobile"
                (mouseenter)="onNavHover($event)" (mouseleave)="onNavLeave()">
                <div class="nav-icon bg-emerald-100">
                    <i class="fa-solid fa-users text-emerald-600"></i>
                </div>
                <span *ngIf="(sidenavService.isOpen$ | async) || isMobile" class="nav-text">المستخدمين</span>
            </a>

            <!-- المجاميع -->
            <a routerLink="/groups" *ngIf="role !== 'Student'" routerLinkActive="active-link"
                [attr.data-gradient]="'linear-gradient(135deg, #f59e0b, #d97706)'" class="nav-item"
                [class.nav-item-collapsed]="!(sidenavService.isOpen$ | async) && !isMobile"
                (mouseenter)="onNavHover($event)" (mouseleave)="onNavLeave()">
                <div class="nav-icon bg-amber-100">
                    <i class="fa-solid fa-users-between-lines text-amber-600"></i>
                </div>
                <span *ngIf="(sidenavService.isOpen$ | async) || isMobile" class="nav-text">المجاميع</span>
            </a>

            <!-- المواد -->
            <a routerLink="/subjects" routerLinkActive="active-link"
                [attr.data-gradient]="'linear-gradient(135deg, #06b6d4, #0891b2)'" class="nav-item"
                [class.nav-item-collapsed]="!(sidenavService.isOpen$ | async) && !isMobile"
                (mouseenter)="onNavHover($event)" (mouseleave)="onNavLeave()">
                <div class="nav-icon bg-cyan-100">
                    <i class="fa-solid fa-book text-cyan-600"></i>
                </div>
                <span *ngIf="(sidenavService.isOpen$ | async) || isMobile" class="nav-text">المواد</span>
            </a>

            <!-- الغياب والحضور -->
            <a routerLink="/attendances" *ngIf="role !== 'Student'" routerLinkActive="active-link"
                [attr.data-gradient]="'linear-gradient(135deg, #8b5cf6, #7c3aed)'" class="nav-item"
                [class.nav-item-collapsed]="!(sidenavService.isOpen$ | async) && !isMobile"
                (mouseenter)="onNavHover($event)" (mouseleave)="onNavLeave()">
                <div class="nav-icon bg-purple-100">
                    <i class="fa-solid fa-person-circle-check text-purple-600"></i>
                </div>
                <span *ngIf="(sidenavService.isOpen$ | async) || isMobile" class="nav-text">الحضور والغياب</span>
            </a>

            <!-- الإختبارات (Admin/Assistant) -->
            <a routerLink="/exams" *ngIf="role === 'Admin' || role === 'Assistant'" routerLinkActive="active-link"
                [attr.data-gradient]="'linear-gradient(135deg, #22c55e, #16a34a)'" class="nav-item"
                [class.nav-item-collapsed]="!(sidenavService.isOpen$ | async) && !isMobile"
                (mouseenter)="onNavHover($event)" (mouseleave)="onNavLeave()">
                <div class="nav-icon bg-green-100">
                    <i class="fa-solid fa-list-check text-green-600"></i>
                </div>
                <span *ngIf="(sidenavService.isOpen$ | async) || isMobile" class="nav-text">إدارة الإختبارات</span>
            </a>

            <!-- اختباراتي (Student) -->
            <a routerLink="/exams/my-exams" *ngIf="role === 'Student'" routerLinkActive="active-link"
                [attr.data-gradient]="'linear-gradient(135deg, #22c55e, #16a34a)'" class="nav-item"
                [class.nav-item-collapsed]="!(sidenavService.isOpen$ | async) && !isMobile"
                (mouseenter)="onNavHover($event)" (mouseleave)="onNavLeave()">
                <div class="nav-icon bg-green-100">
                    <i class="fa-solid fa-clipboard-list text-green-600"></i>
                </div>
                <span *ngIf="(sidenavService.isOpen$ | async) || isMobile" class="nav-text">اختباراتي</span>
            </a>

            <!-- الفيديوهات -->
            <a routerLink="/videos" routerLinkActive="active-link"
                [attr.data-gradient]="'linear-gradient(135deg, #ef4444, #dc2626)'" class="nav-item"
                [class.nav-item-collapsed]="!(sidenavService.isOpen$ | async) && !isMobile"
                (mouseenter)="onNavHover($event)" (mouseleave)="onNavLeave()">
                <div class="nav-icon bg-red-100">
                    <i class="fa-solid fa-circle-play text-red-600"></i>
                </div>
                <span *ngIf="(sidenavService.isOpen$ | async) || isMobile" class="nav-text">الفيديوهات</span>
            </a>

            <!-- المدفوعات -->
            <a routerLink="/payments" *ngIf="role !== 'Student'" routerLinkActive="active-link"
                [attr.data-gradient]="'linear-gradient(135deg, #6366f1, #4f46e5)'" class="nav-item"
                [class.nav-item-collapsed]="!(sidenavService.isOpen$ | async) && !isMobile"
                (mouseenter)="onNavHover($event)" (mouseleave)="onNavLeave()">
                <div class="nav-icon bg-indigo-100">
                    <i class="fa-solid fa-sack-dollar text-indigo-600"></i>
                </div>
                <span *ngIf="(sidenavService.isOpen$ | async) || isMobile" class="nav-text">المدفوعات</span>
            </a>

            <!-- النفقات -->
            <a routerLink="/expenses" *ngIf="role !== 'Student'" routerLinkActive="active-link"
                [attr.data-gradient]="'linear-gradient(135deg, #f43f5e, #e11d48)'" class="nav-item"
                [class.nav-item-collapsed]="!(sidenavService.isOpen$ | async) && !isMobile"
                (mouseenter)="onNavHover($event)" (mouseleave)="onNavLeave()">
                <div class="nav-icon bg-rose-100">
                    <i class="fa-solid fa-money-bill-transfer text-rose-600"></i>
                </div>
                <span *ngIf="(sidenavService.isOpen$ | async) || isMobile" class="nav-text">النفقات</span>
            </a>

            <!-- الرسائل -->
            <a routerLink="/messages" routerLinkActive="active-link"
                [attr.data-gradient]="'linear-gradient(135deg, #f59e0b, #d97706)'" class="nav-item"
                [class.nav-item-collapsed]="!(sidenavService.isOpen$ | async) && !isMobile"
                (mouseenter)="onNavHover($event)" (mouseleave)="onNavLeave()">
                <div class="nav-icon bg-amber-100">
                    <svg class="w-5 h-5 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
                    </svg>
                </div>
                <span *ngIf="(sidenavService.isOpen$ | async) || isMobile" class="nav-text">الرسائل</span>
                <span *ngIf="((sidenavService.isOpen$ | async) || isMobile) && unreadCount > 0"
                    class="notification-badge">
                    {{ unreadCount }}
                </span>
            </a>
            <hr class="text-gray-200">

            <!-- تسجيل الخروج -->
            <a *ngIf="role" (click)="logout()" [attr.data-gradient]="'linear-gradient(135deg, #f59e0b, #d97706)'"
                class="nav-item" [class.nav-item-collapsed]="!(sidenavService.isOpen$ | async) && !isMobile"
                (mouseenter)="onNavHover($event)" (mouseleave)="onNavLeave()">
                <div class="nav-icon bg-red-100">
                    <i class="fa-solid fa-right-to-bracket text-red-600"></i>
                </div>
                <span *ngIf="(sidenavService.isOpen$ | async) || isMobile" class="nav-text">تسجيل الخروج</span>
            </a>
        </nav>

        <!-- Footer - User Profile -->
        <div class="sidenav-footer cursor-pointer" routerLink="/users/profile">
            <!-- Full Profile -->
            <div *ngIf="(sidenavService.isOpen$ | async) || isMobile" class="user-profile-full">
                <div class="user-avatar-wrapper">
                    <img src="https://ui-avatars.com/api/?name=محمد+احمد&background=4F46E5&color=fff&size=128"
                        alt="User" class="user-avatar">
                    <div class="online-indicator"></div>
                </div>
                <div class="user-info">
                    <p class="user-name">{{user?.firstName}} {{user?.lastName}}</p>
                    <p class="profile-role">{{getRoleLabel( user?.role)}}</p>

                </div>
            </div>
        </div>

    </div>
</aside>